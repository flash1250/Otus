Установка postgresql (папка манифестов postgres)

helm repo update

kubectl apply -f postgres-pv.yaml
kubectl apply -f postgres-pvc.yaml

helm install postgresql oci://registry-1.docker.io/bitnamicharts/postgresql --set persistence.existingClaim=postgresql-pv-claim --set volumePermissions.enabled=true -f values.yaml

После запуска пода:
kubectl exec -it postgresql-0 -- psql -h localhost -U otuspostgres --password -p 5432 otuspostgres
Password: otuspostgres

При удачном подключении выполнить скрипты:
1.
CREATE TABLE IF NOT EXISTS public.users
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    login text COLLATE pg_catalog."default",
    password text COLLATE pg_catalog."default",
    is_logged_in boolean,
	CONSTRAINT "PK_users" PRIMARY KEY (id)
);

TABLESPACE pg_default;

ALTER TABLE IF EXISTS public.users
    OWNER to otuspostgres;

2.
CREATE TABLE IF NOT EXISTS public.user_profiles
(
    id bigint NOT NULL GENERATED BY DEFAULT AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
	user_id bigint NOT NULL,
    first_name text COLLATE pg_catalog."default",
	last_name text COLLATE pg_catalog."default",
	email text COLLATE pg_catalog."default",
	CONSTRAINT "PK_user_profiles" PRIMARY KEY (id),
    CONSTRAINT "FK_user_profiles_users" FOREIGN KEY (user_id)
        REFERENCES public.users (id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION   
)

TABLESPACE pg_default;

ALTER TABLE IF EXISTS public.user_profiles
    OWNER to otuspostgres;


Установка приложения

1. папка манифестов MainService

kubectl apply -f deployment.yaml
kubectl apply -f service.yaml
kubectl apply -f ingress.yaml

2.папка манифестов UserService
kubectl apply -f deployment.yaml
kubectl apply -f service.yaml
kubectl apply -f ingress.yaml
kubectl apply -f secrets.yaml

